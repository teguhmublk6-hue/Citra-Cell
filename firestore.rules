/**
 * @fileOverview Firestore Security Rules for BrimoUI.
 *
 * Core Philosophy:
 * This ruleset is in prototyping mode and prioritizes developer velocity.  It allows open reads and writes to facilitate rapid development.  However, it includes placeholder `TODO` rules for access control that MUST be addressed before production use.
 *
 * Data Structure:
 * - /kasAccounts/{kasAccountId}: Stores cash account details.
 * - /kasAccounts/{kasAccountId}/transactions/{transactionId}: Stores transaction history for each cash account.
 *
 * Key Security Decisions:
 * - Open Reads: Both `get` and `list` operations are open to all users (authenticated or unauthenticated).
 * - Open Writes: Both `create`, `update` and `delete` operations are open to all users (authenticated or unauthenticated).
 * - IMPORTANT:  The `TODO` comments highlight where proper authorization checks (e.g., ownership, roles) MUST be implemented before deploying to production.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any user to read or write cash account data.  THIS IS INSECURE FOR PRODUCTION.
     * @path /kasAccounts/{kasAccountId}
     * @allow (get, list) Any user can read account details.
     * @allow (create, update, delete) Any user can modify account details. THIS IS INSECURE FOR PRODUCTION.
     * @deny None (currently open).
     * @principle Open access for prototyping.  MUST be restricted before production.
     */
    match /kasAccounts/{kasAccountId} {
      allow get, list: if true;
      allow create, update, delete: if true; // TODO: Add proper authorization (e.g., owner-only or role-based access) before production.
    }

    /**
     * @description Allows any user to read or write transaction data for any cash account. THIS IS INSECURE FOR PRODUCTION.
     * @path /kasAccounts/{kasAccountId}/transactions/{transactionId}
     * @allow (get, list) Any user can read transaction history.
     * @allow (create, update, delete) Any user can modify transaction history. THIS IS INSECURE FOR PRODUCTION.
     * @deny None (currently open).
     * @principle Open access for prototyping. MUST be restricted before production.
     */
    match /kasAccounts/{kasAccountId}/transactions/{transactionId} {
      allow get, list: if true;
      allow create, update, delete: if true; // TODO: Add proper authorization (e.g., owner-only or role-based access) before production.
    }

    /**
     * @description Customer Transfers - there are no specific rules defined in the schema. This rule allows any user to read and write to this collection. THIS IS INSECURE FOR PRODUCTION.
     * @path /customerTransfers
     * @allow (get, list) Any user can read customer transfer data.
     * @allow (create, update, delete) Any user can modify customer transfer data. THIS IS INSECURE FOR PRODUCTION.
     * @deny None (currently open).
     * @principle Open access for prototyping.  MUST be restricted before production.
     */
    match /customerTransfers {
      allow get, list: if true;
      allow create, update, delete: if true; // TODO: Add proper authorization (e.g., owner-only or role-based access) before production.
    }
  }
}